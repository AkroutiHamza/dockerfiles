version: '3.6'
services:
  # node:
  #   image: ${DOCKER_REPO_PUSH}node:${NODE_TAG}
  #   restart: 'no'
  #   build:
  #     context: ./docker-images/node
  #     target: node
  #     args:
  #       NODE_TAG: ${NODE_TAG}
    
  # node-python:
  #   image: ${DOCKER_REPO_PUSH}node:${NODE_TAG}-python-${PYTHON_TAG}
  #   restart: 'no'
  #   build:
  #     context: ./docker-images/node
  #     target: node-python
  #     args:
  #       NODE_TAG: ${NODE_TAG}
  #       PYTHON_TAG: ${PYTHON_TAG}

  #   command: tail -f /dev/null

  jenkins-dind:
    build:
      context: ./docker-images/jenkins
      # target: jenkins-dind
    restart: "unless-stopped"
    privileged: true
    # user: root
    environment:
      - JAVA_OPTS="-Djenkins.install.runSetupWizard=false -Djava.awt.headless=true"
      - DOCKER_GID_ON_HOST=20 # MAc $(id -g) Linux $(cat /etc/group | grep docker: | cut -d: -f3)
    ports:
      - 8080:8080
      - 50000:50000
    volumes:
      - jenkins-home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock:ro
    command: "--plugins=blueocean:1.19.0"

  remark:
    build:
      context: ./docker-images/remark
      target: remark
      args:
        NGINX_VERSION: 1.17-alpine
        REMARK_VERSION: '0.14.0'
    restart: "no"
    image: abdennour/remark:0.14.0-nginx-1.17-alpine

  aws:
    build: 
      context: ./docker-images/aws
      args:
        AWS_CLI_VERSION: ${AWS_CLI_VERSION}    
volumes:
  jenkins-home:
    name: jenkins-home